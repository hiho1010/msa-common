plugins {
    id 'java-library' // api êµ¬ì„±ì„ ìœ„í•´ í•„ìˆ˜
    id 'maven-publish' // [ì¶”ê°€ë¨] publishing ë¸”ë¡ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ í•„ìˆ˜
    id 'org.springframework.boot' version '3.5.0'
    id 'io.spring.dependency-management' version '1.1.7'
}

group = 'org.bangbang'// (ì„ íƒì‚¬í•­) í”„ë¡œì íŠ¸ ê·¸ë£¹ ID
version = '0.0.8'

repositories {
    mavenCentral()
}

// ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª¨ë“ˆì´ë¯€ë¡œ bootJarëŠ” ë„ê³  ì¼ë°˜ jarë§Œ ìƒì„±
bootJar {
    enabled = false
}

jar {
    enabled = true
    archiveClassifier = null
}

// ë²„ì „ ë³€ìˆ˜
ext {
    set('springCloudVersion', "2025.0.0")
    set('resilience4jVersion', "2.3.0")
    set('springDocVersion', "2.8.14")
}

dependencyManagement {
    imports {
        mavenBom "org.springframework.cloud:spring-cloud-dependencies:${springCloudVersion}"
        mavenBom "io.github.resilience4j:resilience4j-bom:${resilience4jVersion}"
    }
}

dependencies {
    // --- [1] ê³µí†µ ìŠ¤íƒ ---
    api 'org.springframework.boot:spring-boot-starter-web'
    api 'org.springframework.boot:spring-boot-starter-security'
    api 'org.springframework.boot:spring-boot-starter-data-jpa'
    api 'org.springframework.boot:spring-boot-starter-aop'
    api 'org.springframework.boot:spring-boot-starter-oauth2-resource-server'

    // --- [2] Spring Cloud ---
    api 'org.springframework.cloud:spring-cloud-starter-config'
    api 'org.springframework.cloud:spring-cloud-starter-loadbalancer'
    api 'org.springframework.cloud:spring-cloud-starter-netflix-eureka-client'
    api 'org.springframework.cloud:spring-cloud-starter-openfeign'

    // --- [3] Resilience4j ---
    api 'io.github.resilience4j:resilience4j-spring-boot3'
    api 'io.github.resilience4j:resilience4j-circuitbreaker'
    api 'io.github.resilience4j:resilience4j-retry'
    api 'io.github.resilience4j:resilience4j-bulkhead'
    api 'io.github.resilience4j:resilience4j-ratelimiter'
    api 'io.micrometer:micrometer-core'

    // --- [4] ìœ í‹¸ë¦¬í‹° ë° ë¬¸ì„œí™” ---
    api 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'

    implementation 'org.springframework.boot:spring-boot-starter-actuator'
    implementation "org.springdoc:springdoc-openapi-starter-webmvc-ui:${springDocVersion}"
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(21)
    }
}

// maven-publish í”ŒëŸ¬ê·¸ì¸ì´ ìˆì–´ì•¼ ì´ ë¸”ë¡ì´ í•´ì„ë¨
publishing {
    publications {
        mavenJava(MavenPublication) {
            // from components.java // ğŸ‘ˆ ì´ ì¤„ì„ ì£¼ì„ ì²˜ë¦¬í•˜ê±°ë‚˜ ì œê±°í•©ë‹ˆë‹¤.

            // ğŸ’¡ ìˆ˜ì •: 'jar' íƒœìŠ¤í¬ì˜ ê²°ê³¼ë¬¼ì„ ì§ì ‘ ì¶”ê°€í•˜ì—¬ -plain ì ‘ë¯¸ì‚¬ê°€ ì—†ëŠ”
            // JAR íŒŒì¼ì„ ë©”ì¸ ì•„í‹°íŒ©íŠ¸ë¡œ ì§€ì •í•©ë‹ˆë‹¤.
            artifact(jar) {
                classifier = null
            }
        }
    }
}

tasks.named('test') {
    useJUnitPlatform()
}